fill = "transparent",
size = 0.3,
linetype="solid")
)
col_country <- c("Other Prairies" = "#666666",
"Canada" = "black",
"Alberta" = "#66a61e",
"Atlantic" = "#e6ab02",
"British Columbia" = "#d95f02",
"Territories" = "#1b9e77",
"Quebec" = "#1E8FCC",
"Ontario" = "#e7298a")
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under, col = Region))+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
scale_colour_manual(values = col_country)+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
legend.text=element_text(size=tx-2),
legend.title=element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under, col = Region))+
geom_point(aes(Age, under_l, col = Region), alpha = 0.4)+
geom_point(aes(Age, under_u, col = Region), alpha = 0.4)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
scale_colour_manual(values = col_country)+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
legend.text=element_text(size=tx-2),
legend.title=element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4)+
geom_point(aes(Age, under_u), alpha = 0.4)+
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
ggsave("Figures/underest_infections.png", width = 5, height = 4.5)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(ymin=under_l, ymax=under_u), colour="black", width=.1, position=pd) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(ymin=under_l, ymax=under_u), colour="black", width=.1) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(ymin=under_l, ymax=under_u), colour="black", width=.1) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.1) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
# geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.1)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
# geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.1) +
facet_wrap(~ Region)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
# geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.5) +
facet_wrap(~ Region)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
# geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.5) +
facet_wrap(~ Region)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
# geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.5) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.5) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
db_infs %>%
filter(Sex == "b") %>%
ggplot()+
geom_point(aes(Age, under))+
# geom_point(aes(Age, under_l), alpha = 0.4, shape = 24)+
# geom_point(aes(Age, under_u), alpha = 0.4, shape = 25)+
geom_errorbar(aes(Age, under, ymin=under_l, ymax=under_u), colour="black", width=.1) +
facet_wrap(~ Region)+
geom_hline(yintercept = 1, linetype = "dashed")+
scale_y_log10(breaks = c(0.1, 0.25, 0.5, 1, 2), labels = percent_format(accuracy = 1L))+
scale_x_continuous(breaks = seq(0, 100, 10))+
labs(title = "Identified COVID infections by age")+
theme_bw()+
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.margin = margin(5,5,5,5,"mm"),
plot.title = element_text(size=tx-1),
axis.text.x = element_text(size=tx),
axis.text.y = element_text(size=tx-2),
axis.title.x = element_text(size=tx-1),
axis.title.y = element_text(size=tx-1),
strip.text.x = element_text(size = 8),
strip.background = element_rect(color = "black",
fill = "transparent",
size = 0.3,
linetype="solid")
)
ggsave("Figures/underest_infections.png", width = 5, height = 4.5)
rm(list=ls())
Sys.setenv(LANG = "en")
Sys.setlocale("LC_ALL","English")
library(tidyverse)
library(lubridate)
library(readxl)
source("Code/00_functions.R")
deaths <- read_csv("Data/201113_13100768-eng.zip")
View(deaths)
deaths <- read_csv("Data/201113_13100768-eng.zip",
col_types = cols(.default = "c")
)
View(deaths)
pop <- read_csv("Data/17100005-eng.zip")
pop <- read_csv("Data/17100005-eng.zip",
col_types = cols(.default = "c"))
View(pop)
deaths2 <- deaths %>%
rename(Region = GEO,
Date = REF_DATE,
Age = 'Age at time of death',
Deaths = VALUE) %>%
select(Region, Date, Age, Sex, Deaths) %>%
mutate(Region = str_remove(Region, ", place of occurrence"),
Age = str_remove(Age, "Age at time of death, "),
Age = str_trim(str_sub(Age, 1, 2)),
Age = ifelse(Age == "al", "All", Age),
Sex = case_when(Sex == "Both sexes" ~ "b",
Sex == "Males" ~ "m",
Sex == "Females" ~ "f"),
Year = year(Date))
View(deaths2)
unique(deaths2$Age)
unique(deaths2$Region)
r <- "Alberta"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
r <- "Alberta"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
deaths2
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()
deaths2
deaths2 <- deaths %>%
rename(Region = GEO,
Date = REF_DATE,
Age = 'Age at time of death',
Deaths = VALUE) %>%
select(Region, Date, Age, Sex, Deaths) %>%
mutate(Region = str_remove(Region, ", place of occurrence"),
Date = ymd(Date)
Age = str_remove(Age, "Age at time of death, "),
Age = str_trim(str_sub(Age, 1, 2)),
Age = ifelse(Age == "al", "All", Age),
Sex = case_when(Sex == "Both sexes" ~ "b",
Sex == "Males" ~ "m",
Sex == "Females" ~ "f"),
Year = year(Date))
deaths2 <- deaths %>%
rename(Region = GEO,
Date = REF_DATE,
Age = 'Age at time of death',
Deaths = VALUE) %>%
select(Region, Date, Age, Sex, Deaths) %>%
mutate(Region = str_remove(Region, ", place of occurrence"),
Date = ymd(Date),
Age = str_remove(Age, "Age at time of death, "),
Age = str_trim(str_sub(Age, 1, 2)),
Age = ifelse(Age == "al", "All", Age),
Sex = case_when(Sex == "Both sexes" ~ "b",
Sex == "Males" ~ "m",
Sex == "Females" ~ "f"),
Year = year(Date))
unique(deaths2$Age)
unique(deaths2$Region)
r <- "Alberta"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
r <- "Alberta"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
deaths2 <- deaths %>%
rename(Region = GEO,
Date = REF_DATE,
Age = 'Age at time of death',
Deaths = VALUE) %>%
select(Region, Date, Age, Sex, Deaths) %>%
mutate(Region = str_remove(Region, ", place of occurrence"),
Date = ymd(Date),
Age = str_remove(Age, "Age at time of death, "),
Age = str_trim(str_sub(Age, 1, 2)),
Age = ifelse(Age == "al", "All", Age),
Sex = case_when(Sex == "Both sexes" ~ "b",
Sex == "Males" ~ "m",
Sex == "Females" ~ "f"),
Year = year(Date),
Deaths = as_integer(Deaths))
deaths2 <- deaths %>%
rename(Region = GEO,
Date = REF_DATE,
Age = 'Age at time of death',
Deaths = VALUE) %>%
select(Region, Date, Age, Sex, Deaths) %>%
mutate(Region = str_remove(Region, ", place of occurrence"),
Date = ymd(Date),
Age = str_remove(Age, "Age at time of death, "),
Age = str_trim(str_sub(Age, 1, 2)),
Age = ifelse(Age == "al", "All", Age),
Sex = case_when(Sex == "Both sexes" ~ "b",
Sex == "Males" ~ "m",
Sex == "Females" ~ "f"),
Year = year(Date),
Deaths = as.integer(Deaths))
unique(deaths2$Age)
unique(deaths2$Region)
r <- "Alberta"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
r <- "Ontario"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
r <- "Quebec"
a <- "85"
deaths2 %>%
filter(Region == r,
Age == a,
Sex == "b") %>%
ggplot()+
geom_line(aes(Date, Deaths))
