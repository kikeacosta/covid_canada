geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
View(db_can_age2)
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
View(db_can_age2)
View(db_can_age2)
# Provintial data with closing age group at 80+
db_prv_age <- db_prv_age %>%
mutate(Age = ifelse(Age >= 80, 80, Age)) %>%
group_by(Region, Code, Date, Age, date_f) %>%
summarise(Cases = sum(Cases),
Deaths = sum(Deaths)) %>%
ungroup()
# Quebec with problems in dates 16.05 and 23.05
db_prv_age <- db_prv_age %>%
filter(!(Region == "Quebec" & Date %in% c("16.05.2020", "23.05.2020")))
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
db_nal_age <- db_nal %>%
mutate(date_f = dmy(Date)) %>%
filter(Age != "TOT",
date_f > "2020-07-07") %>%
mutate(Sex = "b") %>%
group_by(Region, Code, Date, Age, Measure, date_f) %>%
summarise(Value = sum(Value)) %>%
mutate(Age = as.integer(Age)) %>%
ungroup()
# Provintial data with closing age group at 80+
db_prv_age <- db_prv_age %>%
mutate(Age = ifelse(Age >= 80, 80, Age)) %>%
group_by(Region, Code, Date, Age, date_f) %>%
summarise(Cases = sum(Cases),
Deaths = sum(Deaths)) %>%
ungroup()
# Quebec with problems in dates 16.05 and 23.05
db_prv_age <- db_prv_age %>%
filter(!(Region == "Quebec" & Date %in% c("16.05.2020", "23.05.2020")))
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
db_nal_age <- db_nal %>%
mutate(date_f = dmy(Date)) %>%
filter(Age != "TOT",
date_f > "2020-07-07") %>%
mutate(Sex = "b") %>%
group_by(Region, Code, Date, Age, Measure, date_f) %>%
summarise(Value = sum(Value)) %>%
mutate(Age = as.integer(Age)) %>%
ungroup()
db_nal_age
# Provintial data with closing age group at 80+
db_prv_age <- db_prv_age %>%
mutate(Age = ifelse(Age >= 80, 80, Age)) %>%
group_by(Region, Code, Date, Age, date_f) %>%
summarise(Cases = sum(Cases),
Deaths = sum(Deaths)) %>%
ungroup()
# Quebec with problems in dates 16.05 and 23.05
db_prv_age <- db_prv_age %>%
filter(!(Region == "Quebec" & Date %in% c("16.05.2020", "23.05.2020")))
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
db_can_age <- bind_rows(db_prv_age, db_nal_age)
View(db_can_age)
db_nal_age <- db_nal %>%
mutate(date_f = dmy(Date)) %>%
filter(Age != "TOT",
date_f > "2020-07-07") %>%
mutate(Sex = "b") %>%
group_by(Region, Code, Date, Age, Measure, date_f) %>%
summarise(Value = sum(Value)) %>%
mutate(Age = as.integer(Age)) %>%
ungroup() %>%
spread('Measure', 'Value')
# Provintial data with closing age group at 80+
db_prv_age <- db_prv_age %>%
mutate(Age = ifelse(Age >= 80, 80, Age)) %>%
group_by(Region, Code, Date, Age, date_f) %>%
summarise(Cases = sum(Cases),
Deaths = sum(Deaths)) %>%
ungroup()
# Quebec with problems in dates 16.05 and 23.05
db_prv_age <- db_prv_age %>%
filter(!(Region == "Quebec" & Date %in% c("16.05.2020", "23.05.2020")))
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
ggsave("Figures/age_cum_cases_over_time.png")
# plotting cumulative deaths
db_can2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Deaths) %>%
ggplot()+
geom_point(aes(date_f, Deaths, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative deaths over time")+
theme_bw()
# plotting cumulative deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Deaths) %>%
ggplot()+
geom_point(aes(date_f, Deaths, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative deaths over time")+
theme_bw()
# exclusion of Mtl last dates, which have wrong data
db_prv_age <- db_prv_age %>%
filter(!(Region == "Montreal" & date_f >= "2020-10-09"))
# exclusion of Mtl last dates, which have wrong data
db_prv_age <- db_prv_age %>%
filter(!(Region == "Montreal" & date_f >= "2020-10-09"))
# binding national and provintial
db_can_age <- bind_rows(db_prv_age, db_nal_age) %>%
drop_na()
# estimating new cases and new deaths
db_can_age2 <- db_can_age %>%
arrange(Region, Age, date_f) %>%
group_by(Region, Age) %>%
mutate(new_c = Cases - lag(Cases),
new_d = Deaths - lag(Deaths)) %>%
ungroup()
# plotting cumulative cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Cases) %>%
ggplot()+
geom_point(aes(date_f, Cases, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative cases over time")+
theme_bw()
ggsave("Figures/age_cum_cases_over_time.png")
# plotting cumulative deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(Deaths) %>%
ggplot()+
geom_point(aes(date_f, Deaths, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "Cumulative deaths over time")+
theme_bw()
ggsave("Figures/age_cum_deaths_over_time.png")
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_c >= 0) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_c >= 0) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
ggsave("Figures/age_new_cases_over_time.png")
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01") %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New deaths over time")+
theme_bw()
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New deaths over time")+
theme_bw()
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 10000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New deaths over time")+
theme_bw()
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New deaths over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_c >= 0 & new_c <= 3000) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_c >= 0 & new_c <= 3000) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
ggsave("Figures/age_new_cases_over_time.png")
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New deaths over time")+
theme_bw()
ggsave("Figures/age_new_deaths_over_time.png")
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age, scales = "free")+
labs(title = "New deaths over time")+
theme_bw()
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "New deaths over time")+
theme_bw()
# plotting new cases
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_c >= 0 & new_c <= 3000) %>%
drop_na(new_c) %>%
ggplot()+
geom_point(aes(date_f, new_c, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_grid(~ Age)+
labs(title = "New cases over time")+
theme_bw()
# plotting new deaths
db_can_age2 %>%
filter(date_f >= "2020-03-01", new_d >= 0 & new_d <= 1000) %>%
drop_na(new_d) %>%
ggplot()+
geom_point(aes(date_f, new_d, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "New deaths over time")+
theme_bw()
ggsave("Figures/age_new_deaths_over_time.png")
# CFRs
db_can_age3 <- db_can_age2 %>%
mutate(CFR = Deaths / Cases)
# plotting CFR over time
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01") %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
# plotting CFR over time
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
# plotting CFR over time
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
ggsave("Figures/age_all_CFR_over_time.png")
db_can_age3 %>%
drop_na(Deaths, Cases) %>%
filter(date_f >= "2020-03-01") %>%
ggplot()+
geom_point(aes(Cases, Deaths, col = Region), size = 0.7, alpha = 0.8)+
# scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
labs(title = "Slopes of overall CFR over time")+
theme_bw()
db_can_age3 %>%
drop_na(Deaths, Cases) %>%
filter(date_f >= "2020-03-01") %>%
ggplot()+
geom_point(aes(Cases, Deaths, col = Region), size = 0.7, alpha = 0.8)+
facet_wrap(~ Age, scales = "free")+
# scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
labs(title = "Slopes of overall CFR over time")+
theme_bw()
ggsave("Figures/age_all_CFR_slopes.png")
# plotting CFR over time
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
# some ages >= 50
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1, Age >= 50) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
# plotting CFR over time
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
ggsave("Figures/age_CFR_over_time.png")
# some ages >= 50
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1, Age >= 50) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
ggsave("Figures/age_over_50_CFR_over_time.png")
# some ages >= 50
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1, Age >= 50,
!(Age == 50 & CFR > 0.03), !(Age == 60 & CFR > 0.1),
!(Age == 80 & CFR > 0.8)) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
# some ages >= 50
db_can_age3 %>%
drop_na(CFR) %>%
filter(date_f >= "2020-03-01", CFR <= 1, Age >= 50,
!(Age == 50 & CFR > 0.03),
!(Age == 60 & CFR > 0.10),
!(Age == 80 & CFR > 0.80)) %>%
ggplot()+
geom_point(aes(date_f, CFR, col = Region), size = 0.7, alpha = 0.8)+
scale_x_date(date_breaks = "1 month", date_labels = "%b %d")+
facet_wrap(~ Age, scales = "free")+
labs(title = "Overall CFR over time")+
theme_bw()
ggsave("Figures/age_over_50_CFR_over_time.png")
