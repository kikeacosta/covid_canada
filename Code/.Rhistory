rm(list=ls())
Sys.setenv(LANG = "en")
Sys.setlocale("LC_ALL","English")
library(tidyverse)
library(readr)
library(lubridate)
library(ggplot2)
library(osfr)
# reading Canada data
db_nal <- read_rds("Data/201020_covid_canada.rds") %>%
mutate(Code = str_replace(Code, Date, "")) %>%
select(Country, Region, Code, Date, Sex, Age, AgeInt, Measure, Value)
osf_retrieve_file("43ucn") %>%
osf_download(conflicts = "overwrite")
# This reads it in
db_cov <-  read_csv("Output_10.zip",
skip = 3,
col_types = "ccccciiddd")
# looking for regions included in COVerAGE-DB
db_cov %>%
filter(Country == "Canada") %>%
mutate(Code = str_replace(Code, Date, "")) %>%
pull(Code) %>%
unique()
# only keeping regions from regional sources
db_prv <- db_cov %>%
filter(Country == "Canada") %>%
mutate(Code = str_replace(Code, Date, "")) %>%
filter(Code %in% c("CA_AB", "CA_BC", "CA_MTL", "CA_ON", "CA_QC")) %>%
select(-Tests)
unique(db_prv$Code)
######################################################
# looking at all population
######################################################
db_prv_all <- db_prv %>%
filter(Sex == "b") %>%
group_by(Region, Code, Date) %>%
summarise(Cases = sum(Cases),
Deaths = sum(Deaths)) %>%
ungroup() %>%
mutate(date_f = dmy(Date)) %>%
arrange(Region, date_f)
db_nal_all <- db_nal %>%
filter(Sex == "b",
Age == "TOT") %>%
spread('Measure', 'Value') %>%
select(Region, Code, Date, Cases, Deaths) %>%
mutate(date_f = dmy(Date)) %>%
arrange(date_f)
db_nal_all <- db_nal %>%
filter(Sex == "b",
Age == "TOT") %>%
spread('Measure', 'Value') %>%
select(Region, Code, Date, Cases, Deaths) %>%
mutate(date_f = dmy(Date)) %>%
arrange(date_f)
